<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>国内生産ランキングクイズ：UNO POINTサンプル（3問）</title>
<style>
  :root{
    --bg:#ffffff; --fg:#0b0f14; --muted:#6a7582; --accent:#3b82f6;
    --ok:#16a34a; --bad:#dc2626; --card:#f8fafc; --chip:#eef2f7; --bar:#93c5fd;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Meiryo",Arial,sans-serif;background:#f3f4f6;color:var(--fg)}
  .wrap{max-width:1100px;margin:0 auto;padding:clamp(12px,2vw,24px)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:0 0 12px}
  h1{font-size:clamp(18px,3.6vw,28px);margin:0;color:#111827}
  main{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;padding:clamp(12px,2.4vw,20px);box-shadow:0 10px 30px rgba(0,0,0,.08)}
  .panel{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:clamp(12px,2.4vw,16px)}
  .rank-title{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}
  .prod-title{display:flex;align-items:center;gap:8px;font-weight:800;font-size:clamp(16px,3.8vw,22px);color:var(--fg);
              background:linear-gradient(90deg,rgba(59,130,246,.10),rgba(59,130,246,.03));
              border:1px solid #bfdbfe;padding:8px 12px;border-radius:12px;flex:1 1 60%;max-width:720px}
  .prod-title.revealed{box-shadow:0 0 0 2px var(--ok) inset;background:rgba(22,163,74,.06)}
  .chip{padding:6px 10px;border-radius:999px;background:#eef2f7;border:1px solid #e2e8f0;color:var(--fg);font-size:clamp(11px,2.2vw,13px);display:inline-flex;gap:6px;align-items:center}
  .bars{display:flex;flex-direction:column;gap:6px}
  .bar{display:grid;grid-template-columns:1fr max-content;gap:8px;align-items:center;font-size:clamp(12px,2.6vw,15px)}
  .bar .lbl{display:flex;align-items:center}
  .lbl-text{padding:2px 6px;border-radius:6px;line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}
  .bar .track{background:#f3f4f6;border:1px solid #d1d5db;border-radius:999px;height:18px;width:100%;position:relative}
  .bar .fill{position:absolute;inset:0;width:0%;background:linear-gradient(90deg,var(--bar),var(--accent));border-radius:999px}
  .bar .val{color:#111827;font-variant-numeric:tabular-nums}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .controls button{background:#fff;border:1px solid #e5e7eb;padding:10px 14px;border-radius:10px;cursor:pointer}
  .controls button:disabled{opacity:.5;cursor:not-allowed}
  .status{display:flex;justify-content:space-between;margin-top:8px;color:var(--muted);font-size:14px}
  #mapWrap{margin-top:12px}
  #map{width:100%;min-height:420px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .map-legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;font-size:12px}
  .legend-swatch{display:inline-block;width:16px;height:12px;border:2px solid #e5e7eb;border-radius:4px;box-sizing:border-box;margin-right:4px}
  .swatch-cand{background:rgba(251,191,36,.35);border-color:#f59e0b}
  .credit{color:#6a7582;font-size:12px;margin-top:6px}
  .geolonia-svg-map{width:100%;height:auto}
  .geolonia-svg-map .prefecture{fill:#dbeafe;stroke:#93c5fd;cursor:pointer}

  .panel.grid-2{display:grid;grid-template-columns:1fr;gap:16px}
  @media (min-width:1024px){
    .panel.grid-2{grid-template-columns:1fr 1fr;align-items:start}
    .col-left, .col-right{min-width:0}
    #map{min-height:480px}
  }
@media (min-width:1024px){
  body{ font-size:18px; }
  .bar{ font-size:16px; gap:12px; }
  .controls button{ font-size:16px; padding:12px 18px; }
  .prod-title{ font-size:24px; padding:12px 16px; }
  #map{ min-height:540px; }
  h1{ font-size:28px; }
}
  .choices{display:grid;grid-template-columns:1fr;gap:8px;margin-top:8px}
  @media (min-width:640px){ .choices{grid-template-columns:1fr 1fr} }
  .choice-btn{background:#fff;border:1px solid #e5e7eb;padding:10px 12px;border-radius:10px;cursor:pointer;text-align:left}
  .choice-btn.correct{border-color:var(--ok);box-shadow:0 0 0 2px rgba(22,163,74,.25)}
  .choice-btn.wrong{border-color:var(--bad);opacity:.9}

  .uno-point{margin-top:12px;background:#fff;border:2px solid #000;border-radius:12px;padding:12px}
  .uno-point h4{margin:0 0 6px;font-size:14px;color:#dc2626}
  .uno-point p{margin:0;font-size:14px;line-height:1.6;color:#374151}
  @media (min-width:1024px){ .uno-point{margin-top:12px;background:#fff;border:2px solid #000;border-radius:12px;padding:12px} .uno-point h4{font-size:15px} }
</style>
</head>
<body>
<div class="wrap">
<header><h1>国内生産ランキングクイズ：UNO POINTサンプル（3問）</h1></header>
<main>
<div class="panel grid-2">
  <section class="col-left">
    <div class="rank-title">
      <div class="prod-title" id="titleBox"><b id="prodName">？？？</b></div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end">
        <div class="chip" id="yearChip">基準年: --</div>
        <div class="chip" id="unitChip">単位: --</div>
        <div class="chip" id="srcChip">出典: --</div>
      </div>
    </div>
    <div aria-live="polite" class="bars" id="bars"></div>

    <h3 style="margin:10px 0 4px;font-size:16px">このランキングは何の品目ですか？</h3>
    <div class="choices" id="choices"></div>

    <div class="controls">
      <button id="prevBtn">◀ 戻る</button>
      <button id="nextBtn">次へ ▶</button>
      <button id="revealBtn">答えを表示</button>
    </div>
    <div class="status">
      <div>問題 <span id="qIndex">1</span>/<span id="qTotal">1</span></div>
      <div>スコア: <span id="score">0</span></div>
    </div>
    <div class="reveal" id="reveal"></div>
    <div id="unoPoint" class="uno-point" style="display:none!important"></div>
  </section>

  <section class="col-right">
    <div id="mapWrap">
      <h2 style="font-size:16px;margin:12px 0 8px">ランキングに含まれる都道府県に色がつきます（上位ほど濃い）</h2>
      <div aria-live="polite" id="map">読み込み中…</div>
      <div class="map-legend" style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
        <span><span class="legend-swatch swatch-cand"></span> ランキングにある地域</span>
      </div>
      <div class="credit">地図データ: Geolonia「japanese-prefectures」 / Wikipedia ベース（GFDL）</div>
    </div>
  </section>
</div>
</main>
</div>

<script>
if(!String.prototype.padStart){
  String.prototype.padStart = function padStart(targetLength, padString){
    targetLength = targetLength >> 0; padString = String(padString || ' ');
    if(this.length >= targetLength) return String(this);
    targetLength = targetLength - this.length;
    if(targetLength > padString.length) padString += padString.repeat(targetLength / padString.length);
    return padString.slice(0, targetLength) + String(this);
  }
}
const CODE_TO_NAME={"01":"北海道","02":"青森","03":"岩手","04":"宮城","05":"秋田","06":"山形","07":"福島","08":"茨城","09":"栃木","10":"群馬","11":"埼玉","12":"千葉","13":"東京","14":"神奈川","15":"新潟","16":"富山","17":"石川","18":"福井","19":"山梨","20":"長野","21":"岐阜","22":"静岡","23":"愛知","24":"三重","25":"滋賀","26":"京都","27":"大阪","28":"兵庫","29":"奈良","30":"和歌山","31":"鳥取","32":"島根","33":"岡山","34":"広島","35":"山口","36":"徳島","37":"香川","38":"愛媛","39":"高知","40":"福岡","41":"佐賀","42":"長崎","43":"熊本","44":"大分","45":"宮崎","46":"鹿児島","47":"沖縄"};
const NAME_TO_CODE = Object.fromEntries(Object.entries(CODE_TO_NAME).map(([k,v])=>[v,k]));
const DATA = [
  { id:"PAPER", label:"パルプ・紙・紙加工 出荷額", unit:"兆円", year:"2022", source:"経産省 工業統計", source_url:"https://www.meti.go.jp/",
    items:[["静岡",3.0],["愛媛",1.5],["埼玉",1.4],["兵庫",1.3],["岡山",1.2]]
  },
  { id:"SHIP", label:"船舶・同修理 出荷額", unit:"兆円", year:"2022", source:"経産省 工業統計", source_url:"https://www.meti.go.jp/",
    items:[["長崎",0.9],["広島",0.8],["愛媛",0.8],["神奈川",0.6],["兵庫",0.6]]
  },
  { id:"SEMI_WAFER", label:"半導体ウエハ関連 出荷額（参考）", unit:"兆円", year:"2022", source:"経産省 工業統計（電子部品内訳参考）", source_url:"https://www.meti.go.jp/",
    items:[["三重",1.2],["熊本",1.1],["広島",0.9],["福岡",0.8],["栃木",0.7]]
  }
];
let history=[]; let pointer=-1; let score=0;
const needs2dec = new Set(["PAPER","SHIP","SEMI_WAFER"]);
const numFmt=(v,id)=> needs2dec.has(id) ? (Math.round(v*100)/100).toFixed(2) : Math.round(v).toString();
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
const DECOYS = ["製造品出荷額等（総額）","情報通信機械 出荷額","精密機械 出荷額","飲料・たばこ・飼料 出荷額","木材・木製品 出荷額","自動車工業 出荷額","電子部品・デバイス 出荷額"];
function pickQuestion(){
  const meta = DATA[Math.floor(Math.random()*DATA.length)];
  const topN = Math.min(meta.items.length, Math.max(5, Math.floor(Math.random()*4)+5));
  const items = meta.items.slice(0, topN);
  const max = items[0][1];
  const viewData = items.map(([pref, val])=>({pref, val, pct:(val/max)*100}));
  const labels = new Set([meta.label]);
  const pool = DATA.map(d=>d.label).filter(l=>l!==meta.label);
  while(labels.size<4){
    if(pool.length){
      labels.add(pool.splice(Math.floor(Math.random()*pool.length),1)[0]);
    }else{
      labels.add(DECOYS[Math.floor(Math.random()*DECOYS.length)]);
    }
  }
  const choices = shuffle(Array.from(labels));
  return {meta, viewData, pickedChoice:null, choices};
}
let codeToEl = {}; let mapReady = false;
async function loadMap(){
  try{
    const res = await fetch("https://geolonia.github.io/japanese-prefectures/map-full.svg",{mode:"cors"});
    if(!res.ok) throw new Error("map fetch failed");
    const svg = await res.text();
    const container = document.getElementById("map");
    container.innerHTML = svg;
    container.querySelectorAll(".prefecture").forEach(el=>{
      const code = String(el.dataset.code||"").padStart(2,"0");
      codeToEl[code]=el;
    });
    mapReady=true;
    if(history[pointer]) applyMap(history[pointer]);
  }catch(e){
    const m = document.getElementById("map");
    if(m) m.textContent = "地図の読み込みに失敗しました。別ブラウザでお試しください。";
    console.error(e);
  }
}
function clearMap(){
  if(!mapReady) return;
  Object.values(codeToEl).forEach(el=>{
    el.style.removeProperty('fill');
    el.style.removeProperty('stroke');
  });
}
function applyMap(q){
  if(!mapReady||!q) return;
  clearMap();
  const n = q.viewData.length;
  const maxA = 0.9, minA = 0.35;
  q.viewData.forEach((row,i)=>{
    const code = NAME_TO_CODE[row.pref];
    const el = codeToEl[code];
    if(el){
      const alpha = (n<=1) ? maxA : (maxA - (maxA-minA) * (i/(n-1)));
      el.style.fill = `rgba(251,191,36,${alpha})`;
      el.style.stroke = "#f59e0b";
    }
  });
}
function render(q){
  const answered = !!q.pickedChoice;
  document.getElementById("prodName").textContent = answered ? q.meta.label : "？？？";
  document.getElementById("titleBox").classList.toggle("revealed", answered);
  document.getElementById("yearChip").textContent = `基準年: ${q.meta.year}`;
  document.getElementById("unitChip").textContent = `単位: ${q.meta.unit}`;
  const srcChip = document.getElementById("srcChip");
  srcChip.textContent = answered ? `出典: ${q.meta.source}` : "";
  srcChip.style.display = answered ? "inline-flex" : "none";
  const bars = document.getElementById("bars"); bars.innerHTML = "";
  q.viewData.forEach((row)=>{
    const el = document.createElement("div");
    el.className = "bar";
    if(answered){
      el.style.gridTemplateColumns = "minmax(8em,10em) 1fr max-content";
      el.innerHTML = `<div class="lbl"><span class="lbl-text" title="${row.pref}">${row.pref}</span></div>
        <div class="track"><div class="fill" style="width:${Math.max(2,row.pct).toFixed(1)}%"></div></div>
        <div class="val">${numFmt(row.val, q.meta.id)} ${q.meta.unit}</div>`;
    }else{
      el.style.gridTemplateColumns = "1fr max-content";
      el.innerHTML = `<div class="track"><div class="fill" style="width:${Math.max(2,row.pct).toFixed(1)}%"></div></div>
        <div class="val">${numFmt(row.val, q.meta.id)} ${q.meta.unit}</div>`;
    }
    bars.appendChild(el);
  });
  const area = document.getElementById("choices"); area.innerHTML = "";
  q.choices.forEach((label)=>{
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    btn.textContent = label;
    btn.addEventListener("click", ()=> answer(label));
    area.appendChild(btn);
  });
  if(answered){
    const correct = q.meta.label;
    document.querySelectorAll(".choice-btn").forEach(b=>{
      if(b.textContent === correct){ b.classList.add("correct"); }
      if(q.pickedChoice !== correct && b.textContent === q.pickedChoice){ b.classList.add("wrong"); }
      b.disabled = true;
    });
  }
  const rev = document.getElementById("reveal");
  if(answered){
    rev.innerHTML = `<div style="padding:10px;border:1px dashed #e5e7eb;border-radius:8px;background:#f8fafc">
      <b>${q.pickedChoice===q.meta.label?"正解！":"不正解…"}</b>　${q.meta.label}（${q.meta.year}）<br>
      出典：${q.meta.source}
    </div>`;
    if(q.meta && q.meta.id === "SEMI_WAFER"){
      rev.innerHTML += `<div class="uno-point"><h4>UNO POINT</h4><p>台湾の世界最大の半導体メーカーTSMCは熊本県菊陽に半導体工場を作りました。ここには阿蘇の豊富な水があり、空港と高速道路に近いという立地により選ばれました。</p></div>`;
    }
    if(q.meta && q.meta.id === "PAPER"){
      rev.innerHTML += `<div class="uno-point"><h4>UNO POINT</h4><p>紙の原料となる木材産地がランキング上位に無いことに注目してください。静岡県は富士の豊富な湧水のため。愛媛県は日照時間の長い瀬戸内海の気候を活かして昔から和紙づくり(よく乾く)が盛んでした。東京、大阪の周辺では紙のリサイクル業が多く集まっています。</p></div>`;
    }
    if(q.meta && q.meta.id === "SHIP"){
      rev.innerHTML += `<div class="uno-point"><h4>UNO POINT</h4><p>長崎や神奈川には昔から大きな軍港があります。瀬戸内海地域は雨の少ない気候が造船の屋外作業に適しています。</p></div>`;
    }
  }else{
    rev.innerHTML = "";
  }
  applyMap(q);
  document.getElementById("qIndex").textContent = (pointer+1);
  document.getElementById("qTotal").textContent = history.length;
  document.getElementById("score").textContent = score;
}
function answer(label){
  const q = history[pointer];
  if(q.pickedChoice) return;
  const correct = q.meta.label;
  q.pickedChoice = label;
  const buttons = Array.from(document.querySelectorAll(".choice-btn"));
  buttons.forEach(b=>{
    if(b.textContent === correct){ b.classList.add("correct"); }
    if(b.textContent === label && label !== correct){ b.classList.add("wrong"); }
    b.disabled = true;
  });
  if(label === correct) score++;
  render(q);
}
function reveal(){
  const q=history[pointer];
  if(!q || q.pickedChoice) return;
  answer(q.meta.label);
}
function next(){
  window.scrollTo({top:0,behavior:'smooth'});
  if(pointer < history.length-1){ pointer++; render(history[pointer]); }
  else { const q=pickQuestion(); history.push(q); pointer=history.length-1; render(q); }
}
function prev(){
  window.scrollTo({top:0,behavior:'smooth'});
  if(pointer>0){ pointer--; render(history[pointer]); }
}
document.getElementById("nextBtn").addEventListener("click", next);
document.getElementById("prevBtn").addEventListener("click", prev);
document.getElementById("revealBtn").addEventListener("click", reveal);
history.push(pickQuestion()); pointer=0; render(history[0]); loadMap();
</script>
</body>
</html>
